<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NYC Parks Weekend Tennis</title>
    <meta name="description" content="Monitor all NYC Parks tennis court availability and receive SMS notifications when courts become available.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 50%, #52c86a 100%);
            min-height: 100vh;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(46, 204, 113, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(39, 174, 96, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(82, 200, 106, 0.05) 0%, transparent 50%);
            pointer-events: none;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .hero {
            text-align: center;
            background: linear-gradient(145deg, #ffffff 0%, #f8fffe 100%);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 
                0 20px 60px rgba(39, 174, 96, 0.15),
                0 0 0 1px rgba(39, 174, 96, 0.1);
            margin-bottom: 30px;
            border-top: 4px solid #27ae60;
            position: relative;
            overflow: hidden;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(39, 174, 96, 0.03) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .hero h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 50%, #229954 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .hero .subtitle {
            font-size: 1.2em;
            color: #34495e;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .tennis-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        .nyc-badge {
            display: inline-block;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin: 10px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }
        
        .nav-tabs {
            display: flex;
            background: linear-gradient(145deg, #ffffff 0%, #f8fffe 100%);
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: 
                0 10px 30px rgba(39, 174, 96, 0.1),
                0 0 0 1px rgba(39, 174, 96, 0.1);
            border-top: 2px solid #27ae60;
        }
        
        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            background: transparent;
            border: none;
            font-size: 16px;
            color: #2c3e50;
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }
        
        .nav-tab:not(.active):hover {
            background: linear-gradient(145deg, #f0f8f0 0%, #e8f5e8 100%);
            color: #27ae60;
        }
        
        .tab-content {
            display: none;
            background: linear-gradient(145deg, #ffffff 0%, #f8fffe 100%);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 
                0 10px 30px rgba(39, 174, 96, 0.1),
                0 0 0 1px rgba(39, 174, 96, 0.1);
            margin-bottom: 20px;
            border-top: 3px solid #27ae60;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Park Selection Styles */
        .park-selector {
            background: linear-gradient(145deg, #f7fcf7 0%, #e8f5e8 100%);
            border: 2px solid #52c86a;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.1);
        }
        
        .park-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .park-option {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e8f5e8;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .park-option:hover {
            border-color: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.1);
        }
        
        .park-option.selected {
            border-color: #27ae60;
            background: linear-gradient(145deg, #e8f5e8 0%, #d4edda 100%);
        }
        
        .park-option input[type="checkbox"] {
            margin-right: 12px;
            transform: scale(1.2);
        }
        
        .park-info h4 {
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 1.1em;
        }
        
        .park-details {
            color: #666;
            font-size: 0.9em;
        }
        
        /* Monitor Tool Styles */
        .status-card {
            background: linear-gradient(145deg, #f8fff8 0%, #f0f8f0 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #27ae60;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.1);
        }
        
        .available {
            border-left-color: #27ae60;
            background: linear-gradient(145deg, #e8f5e8 0%, #d4edda 100%);
            color: #155724;
        }
        
        .unavailable {
            border-left-color: #e74c3c;
            background: linear-gradient(145deg, #fdf2f2 0%, #f8d7da 100%);
            color: #721c24;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        
        button {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 150px;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.2);
        }
        
        button:hover {
            background: linear-gradient(135deg, #229954 0%, #27ae60 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.3);
        }
        
        button:disabled {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }
        
        .weekend-dates {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
            padding: 18px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            color: #155724;
            border: 2px solid #27ae60;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.1);
        }
        
        .court-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }
        
        .court-table th, .court-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        
        .court-table th {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            font-weight: bold;
            padding: 12px 8px;
        }
        
        .available-slot {
            background: linear-gradient(145deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            font-weight: bold;
        }
        
        .last-checked {
            text-align: center;
            color: #6c757d;
            font-size: 14px;
            margin-top: 20px;
        }
        
        .notification-settings {
            background: linear-gradient(145deg, #f7fcf7 0%, #e8f5e8 100%);
            border: 2px solid #52c86a;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.1);
        }
        
        .auto-refresh {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        select, input[type="tel"], input[type="text"], input[type="password"] {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-size: 14px;
        }
        
        /* About Page Styles */
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .feature-card {
            background: linear-gradient(145deg, #f8fff8 0%, #f0f8f0 100%);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid #e8f5e8;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.05);
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            border-color: #27ae60;
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.15);
        }
        
        .feature-icon {
            font-size: 2em;
            margin-bottom: 10px;
            display: block;
        }
        
        .highlight {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
            padding: 25px;
            border-radius: 12px;
            border-left: 6px solid #27ae60;
            margin: 25px 0;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.1);
        }
        
        .contact-info {
            text-align: center;
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(145deg, #f8fff8 0%, #f0f8f0 100%);
            border-radius: 12px;
            border: 2px solid #e8f5e8;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.1);
        }
        
        .parks-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .park-card {
            background: linear-gradient(145deg, #f8fff8 0%, #f0f8f0 100%);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e8f5e8;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.05);
        }
        
        .park-card h4 {
            color: #27ae60;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .park-card .borough {
            background: #27ae60;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .hero {
                padding: 25px 20px;
            }
            
            .hero h1 {
                font-size: 2em;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .auto-refresh {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .park-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="hero">
            <span class="tennis-icon">🎾</span>
            <h1>NYC Parks Weekend Tennis</h1>
            <div class="nyc-badge">🗽 All 5 Boroughs</div>
            <p class="subtitle">Monitor all NYC Parks tennis courts and get instant weekend availability alerts</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('monitor')">Court Monitor</button>
            <button class="nav-tab" onclick="showTab('about')">About & Parks</button>
        </div>
        
        <!-- Monitor Tool Tab -->
        <div id="monitor" class="tab-content active">
            <div class="park-selector">
                <strong>🏞️ Select Parks to Monitor:</strong>
                <div class="park-grid" id="parkGrid">
                    <!-- Parks will be populated by JavaScript -->
                </div>
                <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                    Select one or more parks to monitor. The tool will check all selected locations.
                </p>
            </div>
            
            <div class="weekend-dates" id="weekendDates">
                This Weekend: Loading...
            </div>
            
            <div class="controls">
                <button onclick="checkAvailability()" id="checkBtn">Check Now</button>
                <button onclick="toggleAutoRefresh()" id="autoBtn">Start Auto-Check</button>
                <button onclick="playTestSound()">Test Sound</button>
            </div>
            
            <div class="auto-refresh">
                <label for="refreshInterval">Auto-check every:</label>
                <select id="refreshInterval">
                    <option value="30">30 seconds</option>
                    <option value="60" selected>1 minute</option>
                    <option value="300">5 minutes</option>
                    <option value="600">10 minutes</option>
                </select>
            </div>
            
            <div class="notification-settings">
                <strong>⏰ Time Filters:</strong>
                <div style="margin: 10px 0;">
                    <label style="display: flex; align-items: center; margin: 5px 0;">
                        <input type="checkbox" id="morningFilter" checked style="margin-right: 8px;">
                        Morning slots (before 1:00 PM)
                    </label>
                    <label style="display: flex; align-items: center; margin: 5px 0;">
                        <input type="checkbox" id="eveningFilter" checked style="margin-right: 8px;">
                        Afternoon/Evening slots (1:00 PM and after)
                    </label>
                </div>
            </div>
            
            <div class="notification-settings">
                <strong>🔔 Notification Settings:</strong>
                <div style="margin: 10px 0;">
                    <label style="display: flex; align-items: center; margin: 5px 0;">
                        <input type="checkbox" id="soundNotifications" checked style="margin-right: 8px;">
                        Sound notifications
                    </label>
                    <label style="display: flex; align-items: center; margin: 5px 0;">
                        <input type="checkbox" id="browserNotifications" checked style="margin-right: 8px;">
                        Browser notifications
                    </label>
                    <label style="display: flex; align-items: center; margin: 5px 0;">
                        <input type="checkbox" id="smsNotifications" style="margin-right: 8px;">
                        SMS notifications
                    </label>
                </div>
                
                <div id="smsSettings" style="display: none; margin-top: 15px; padding: 15px; background: #e8f4f8; border-radius: 8px;">
                    <h4>📱 SMS Configuration</h4>
                    <div style="margin: 10px 0;">
                        <label>Phone Number (with country code):</label><br>
                        <input type="tel" id="phoneNumber" placeholder="+1234567890" style="width: 200px; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <strong>Choose SMS Method:</strong>
                        <div style="margin: 10px 0;">
                            <label style="display: block; margin: 5px 0;">
                                <input type="radio" name="smsMethod" value="twilio" checked style="margin-right: 8px;">
                                <strong>Twilio API</strong> (Recommended - most reliable)
                            </label>
                            <div id="twilioSettings" style="margin-left: 25px;">
                                <input type="text" id="twilioSid" placeholder="Twilio Account SID" style="width: 250px; padding: 5px; margin: 5px 0; display: block;">
                                <input type="password" id="twilioToken" placeholder="Twilio Auth Token" style="width: 250px; padding: 5px; margin: 5px 0; display: block;">
                                <input type="tel" id="twilioFrom" placeholder="Twilio Phone Number" style="width: 250px; padding: 5px; margin: 5px 0; display: block;">
                                <small style="color: #666;">Get these from your <a href="https://console.twilio.com/" target="_blank">Twilio Console</a></small>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="testSMS()" style="background: #28a745; margin-top: 10px;">Test SMS</button>
                </div>
                
                <p style="margin-top: 15px; font-size: 14px; color: #666;">
                    Keep this tab open for notifications to work. By entering your phone number, you opt-in to receive SMS notifications about tennis court availability.
                </p>
            </div>
            
            <div id="results">
                <div class="loading">Select parks and click "Check Now" to start monitoring</div>
            </div>
            
            <div class="last-checked" id="lastChecked"></div>
        </div>
        
        <!-- About Tab -->
        <div id="about" class="tab-content">
            <h2>🗽 About NYC Parks Weekend Tennis</h2>
            <p>This tool monitors the official NYC Parks tennis reservation system across all 5 boroughs and sends notifications when courts become available for the upcoming weekend.</p>
            
            <div class="highlight">
                <h4>🎯 All NYC Tennis Facilities</h4>
                <p><strong>Coverage:</strong> 8 major tennis facilities across Manhattan, Brooklyn, Queens, and the Bronx</p>
                <p><strong>Courts Monitored:</strong> 25 total reservation courts across all locations</p>
                <p><strong>System:</strong> Official NYC Parks online reservation system</p>
                <p><strong>Cost:</strong> $15 per hour for advance reservations (plus permit)</p>
                <p><strong>Permits:</strong> Season or single-play permits required</p>
            </div>
            
            <div class="features">
                <div class="feature-card">
                    <span class="feature-icon">🗽</span>
                    <h3>Citywide Coverage</h3>
                    <p>Monitor tennis courts across all 5 NYC boroughs from one dashboard</p>
                </div>
                
                <div class="feature-card">
                    <span class="feature-icon">📱</span>
                    <h3>Instant Alerts</h3>
                    <p>SMS and browser notifications when courts become available at your selected parks</p>
                </div>
                
                <div class="feature-card">
                    <span class="feature-icon">⏰</span>
                    <h3>Smart Filtering</h3>
                    <p>Choose morning or evening slots and select only the parks you're interested in</p>
                </div>
                
                <div class="feature-card">
                    <span class="feature-icon">🎯</span>
                    <h3>Weekend Focus</h3>
                    <p>Automatically detects and monitors the current weekend across all selected locations</p>
                </div>
            </div>
            
            <h3>🏞️ NYC Tennis Facilities</h3>
            <div class="parks-list">
                <div class="park-card">
                    <div class="borough">Manhattan</div>
                    <h4>Central Park</h4>
                    <p><strong>Courts:</strong> 6 reservation / 26 total<br>
                    <strong>Surface:</strong> Clay courts<br>
                    <strong>Season:</strong> April 1 - November 24</p>
                </div>
                
                <div class="park-card">
                    <div class="borough">Manhattan</div>
                    <h4>Riverside Park (96th St)</h4>
                    <p><strong>Courts:</strong> 2 reservation / 10 total<br>
                    <strong>Surface:</strong> Clay courts<br>
                    <strong>Season:</strong> April 21 - September 14</p>
                </div>
                
                <div class="park-card">
                    <div class="borough">Manhattan</div>
                    <h4>Riverside Park (119th St)</h4>
                    <p><strong>Courts:</strong> 2 reservation / 10 total<br>
                    <strong>Surface:</strong> Hard courts<br>
                    <strong>Season:</strong> April 19 - September 14</p>
                </div>
                
                <div class="park-card">
                    <div class="borough">Manhattan</div>
                    <h4>Randall's Island</h4>
                    <p><strong>Courts:</strong> 4 reservation / 8 total<br>
                    <strong>Surface:</strong> Hard courts<br>
                    <strong>Season:</strong> May 23 - September 1</p>
                </div>
                
                <div class="park-card">
                    <div class="borough">Manhattan</div>
                    <h4>Queensborough Oval</h4>
                    <p><strong>Courts:</strong> 2 reservation / 6 total<br>
                    <strong>Surface:</strong> Hard courts<br>
                    <strong>Season:</strong> April 21 - September 7</p>
                </div>
                
                <div class="park-card">
                    <div class="borough">Brooklyn</div>
                    <h4>McCarren Park</h4>
                    <p><strong>Courts:</strong> 2 reservation / 7 total<br>
                    <strong>Surface:</strong> Hard courts<br>
                    <strong>Season:</strong> May 4 - September 20</p>
                </div>
                
                <div class="park-card">
                    <div class="borough">Queens</div>
                    <h4>Alley Pond Park</h4>
                    <p><strong>Courts:</strong> 4 reservation / 15 total<br>
                    <strong>Surface:</strong> Hard courts<br>
                    <strong>Season:</strong> May 12 - September 30</p>
                </div>
                
                <div class="park-card">
                    <div class="borough">Bronx</div>
                    <h4>Mill Pond Park</h4>
                    <p><strong>Courts:</strong> 3 reservation / 8 total<br>
                    <strong>Surface:</strong> Hard courts<br>
                    <strong>Season:</strong> May 5 - October 15</p>
                </div>
            </div>
            
            <h3>🎾 How the NYC Parks System Works</h3>
            <p>The tool connects to the official NYC Parks tennis reservation system at <strong>nycgovparks.org</strong>. Each facility offers a mix of reservation and walk-on courts, with advance online reservations available for select courts.</p>
            
            <div class="highlight">
                <h4>📋 NYC Parks Reservation Rules</h4>
                <p><strong>Permit Required:</strong> Season or single-play tennis permit required</p>
                <p><strong>Advance Booking:</strong> Up to 7 days in advance (30 days for Central Park)</p>
                <p><strong>Same Day:</strong> No same-day online reservations allowed</p>
                <p><strong>Modifications:</strong> One rebooking allowed per reservation</p>
                <p><strong>Cost:</strong> $15 per hour + permit fees</p>
                <p><strong>Cancellation:</strong> Must cancel at least 24 hours in advance</p>
            </div>
            
            <div class="highlight">
                <h4>📲 SMS Opt-In Information</h4>
                <p><strong>Voluntary Participation:</strong> Users voluntarily provide their phone number to receive SMS notifications about tennis court availability.</p>
                <p><strong>Message Content:</strong> SMS messages contain information about available court times, locations, and links to the reservation system.</p>
                <p><strong>Frequency:</strong> Messages are only sent when courts become available - typically 0-10 messages per day during peak season.</p>
                <p><strong>Opt-Out:</strong> Users can disable SMS notifications at any time by unchecking the SMS option in the tool.</p>
            </div>
            
            <h3>🔒 Privacy & Official Compliance</h3>
            <p>• This tool accesses only publicly available court data from the official NYC Parks website</p>
            <p>• Phone numbers are stored locally in your browser only - never transmitted except for SMS delivery</p>
            <p>• All monitoring happens client-side with no data collection on our servers</p>
            <p>• Tool operates within NYC Parks' public data access guidelines</p>
            <p>• Not affiliated with NYC Parks - this is an independent monitoring utility</p>
            
            <h3>⚖️ Technical Details & Compliance</h3>
            <p>• Monitors all 25 reservable courts across 8 NYC tennis facilities</p>
            <p>• Respects NYC Parks system rate limits and access policies</p>
            <p>• Uses official NYC Parks reservation URLs for direct booking links</p>
            <p>• SMS delivery via Twilio API with proper opt-in consent mechanisms</p>
            <p>• Fast backend proxy ensures reliable performance across all devices</p>
            
            <div class="contact-info">
                <h3>📞 Contact & Support</h3>
                <p><strong>Tool Support:</strong> <a href="mailto:tenniscourtmonitor@gmail.com" style="color: #27ae60;">tenniscourtmonitor@gmail.com</a></p>
                <p><strong>NYC Parks Tennis:</strong> <a href="https://www.nycgovparks.org/things-to-do/tennis" target="_blank" style="color: #27ae60;">Official Tennis Information</a></p>
                <p><strong>Online Reservations:</strong> <a href="https://www.nycgovparks.org/tennisreservation" target="_blank" style="color: #27ae60;">NYC Parks Reservation System</a></p>
                <p style="margin-top: 15px; font-size: 0.9em; color: #666;">
                    🌳 Independent monitoring tool for NYC Parks tennis courts • Not affiliated with NYC Parks
                </p>
            </div>
        </div>
    </div>

    <script>
        let autoRefreshInterval = null;
        let isAutoRefreshing = false;
        
        // NYC Parks tennis facilities data
        const nycParks = [
            {
                id: 12,
                name: "Central Park",
                borough: "Manhattan",
                courts: 6,
                surface: "Clay",
                season: "April - November"
            },
            {
                id: 13,
                name: "Alley Pond Park",
                borough: "Queens", 
                courts: 4,
                surface: "Hard",
                season: "May - September"
            },
            {
                id: 14,
                name: "McCarren Park",
                borough: "Brooklyn",
                courts: 2,
                surface: "Hard", 
                season: "May - September"
            },
            {
                id: 15,
                name: "Mill Pond Park",
                borough: "Bronx",
                courts: 3,
                surface: "Hard",
                season: "May - October"
            },
            {
                id: 16,
                name: "Riverside Park (96th St)",
                borough: "Manhattan",
                courts: 2,
                surface: "Clay",
                season: "April - September"
            },
            {
                id: 17,
                name: "Riverside Park (119th St)", 
                borough: "Manhattan",
                courts: 2,
                surface: "Hard",
                season: "April - September"
            },
            {
                id: 18,
                name: "Randall's Island",
                borough: "Manhattan",
                courts: 4,
                surface: "Hard",
                season: "May - September"
            },
            {
                id: 19,
                name: "Queensborough Oval",
                borough: "Manhattan",
                courts: 2,
                surface: "Hard",
                season: "April - September"
            }
        ];
        
        // Tab Management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        // Initialize park selector
        function initializeParkSelector() {
            const parkGrid = document.getElementById('parkGrid');
            
            nycParks.forEach(park => {
                const parkOption = document.createElement('div');
                parkOption.className = 'park-option';
                parkOption.innerHTML = `
                    <input type="checkbox" id="park_${park.id}" value="${park.id}" onchange="toggleParkSelection(${park.id})">
                    <div class="park-info">
                        <h4>${park.name}</h4>
                        <div class="park-details">
                            ${park.borough} • ${park.courts} courts • ${park.surface} surface
                        </div>
                    </div>
                `;
                parkGrid.appendChild(parkOption);
            });
            
            // Load saved selections
            loadParkSelections();
        }
        
        // Toggle park selection
        function toggleParkSelection(parkId) {
            const checkbox = document.getElementById(`park_${parkId}`);
            const parkOption = checkbox.closest('.park-option');
            
            if (checkbox.checked) {
                parkOption.classList.add('selected');
            } else {
                parkOption.classList.remove('selected');
            }
            
            saveParkSelections();
        }
        
        // Save park selections to localStorage
        function saveParkSelections() {
            const selectedParks = [];
            nycParks.forEach(park => {
                const checkbox = document.getElementById(`park_${park.id}`);
                if (checkbox.checked) {
                    selectedParks.push(park.id);
                }
            });
            
            try {
                localStorage.setItem('selectedParks', JSON.stringify(selectedParks));
            } catch (e) {
                console.log('Could not save park selections');
            }
        }
        
        // Load park selections from localStorage
        function loadParkSelections() {
            try {
                const savedParks = localStorage.getItem('selectedParks');
                if (savedParks) {
                    const selectedParks = JSON.parse(savedParks);
                    selectedParks.forEach(parkId => {
                        const checkbox = document.getElementById(`park_${parkId}`);
                        if (checkbox) {
                            checkbox.checked = true;
                            toggleParkSelection(parkId);
                        }
                    });
                } else {
                    // Default to Central Park selected
                    const centralPark = document.getElementById('park_12');
                    if (centralPark) {
                        centralPark.checked = true;
                        toggleParkSelection(12);
                    }
                }
            } catch (e) {
                console.log('Could not load park selections');
            }
        }
        
        // Get selected parks
        function getSelectedParkIds() {
            const selectedParks = [];
            nycParks.forEach(park => {
                const checkbox = document.getElementById(`park_${park.id}`);
                if (checkbox && checkbox.checked) {
                    selectedParks.push(park.id);
                }
            });
            return selectedParks;
        }
        
        // Get this weekend's dates based on current day
        function getWeekendDates() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            
            let saturday, sunday;
            
            if (dayOfWeek === 0) {
                sunday = new Date(today);
                saturday = new Date(today);
                saturday.setDate(today.getDate() - 1);
            } else if (dayOfWeek === 6) {
                saturday = new Date(today);
                sunday = new Date(today);
                sunday.setDate(today.getDate() + 1);
            } else {
                const daysUntilSaturday = 6 - dayOfWeek;
                saturday = new Date(today);
                saturday.setDate(today.getDate() + daysUntilSaturday);
                
                sunday = new Date(saturday);
                sunday.setDate(saturday.getDate() + 1);
            }
            
            const formatDate = (date) => {
                const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                return `${days[date.getDay()]}, ${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
            };
            
            return {
                saturday: saturday,
                sunday: sunday,
                saturdayFormatted: formatDate(saturday),
                sundayFormatted: formatDate(sunday)
            };
        }
        
        // Update weekend dates display
        function updateWeekendDisplay() {
            const dates = getWeekendDates();
            const today = new Date();
            const dayOfWeek = today.getDay();
            
            let weekendLabel = "This Weekend";
            if (dayOfWeek === 0) {
                weekendLabel = "This Weekend (Today & Yesterday)";
            } else if (dayOfWeek === 6) {
                weekendLabel = "This Weekend (Today & Tomorrow)";
            } else {
                weekendLabel = "This Weekend (Upcoming)";
            }
            
            document.getElementById('weekendDates').innerHTML = 
                `${weekendLabel}: ${dates.saturdayFormatted} & ${dates.sundayFormatted}`;
        }
        
        // Play notification sound
        function playNotificationSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            const frequencies = [800, 1000, 1200];
            frequencies.forEach((freq, index) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = freq;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                }, index * 200);
            });
        }
        
        function playTestSound() {
            playNotificationSound();
        }
        
        // SMS Notification Functions
        async function sendSMS(message) {
            const smsEnabled = document.getElementById('smsNotifications').checked;
            if (!smsEnabled) return;
            
            const phoneNumber = document.getElementById('phoneNumber').value.trim();
            
            if (!phoneNumber) {
                alert('Please enter a phone number for SMS notifications');
                return;
            }
            
            await sendTwilioSMS(message, phoneNumber);
        }
        
        async function sendTwilioSMS(message, phoneNumber) {
            const accountSid = document.getElementById('twilioSid').value.trim();
            const authToken = document.getElementById('twilioToken').value.trim();
            const fromNumber = document.getElementById('twilioFrom').value.trim();
            
            if (!accountSid || !authToken || !fromNumber) {
                alert('Please fill in all Twilio credentials');
                return;
            }
            
            try {
                const response = await fetch(`https://api.twilio.com/2010-04-01/Accounts/${accountSid}/Messages.json`, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Basic ' + btoa(`${accountSid}:${authToken}`),
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: new URLSearchParams({
                        'From': fromNumber,
                        'To': phoneNumber,
                        'Body': message
                    })
                });
                
                if (response.ok) {
                    showNotificationStatus('SMS sent successfully via Twilio!');
                } else {
                    const error = await response.text();
                    console.error('Twilio SMS error:', error);
                    showNotificationStatus('Failed to send SMS via Twilio');
                }
            } catch (error) {
                console.error('SMS sending error:', error);
                showNotificationStatus('Error sending SMS - check console for details');
            }
        }
        
        async function testSMS() {
            const message = "🎾 Test: NYC Parks tennis monitor is working! This is how you'll be notified when courts become available.";
            await sendSMS(message);
        }
        
        function showNotificationStatus(message) {
            const statusDiv = document.createElement('div');
            statusDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #007bff;
                color: white;
                padding: 15px;
                border-radius: 8px;
                z-index: 1000;
                max-width: 300px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            `;
            statusDiv.textContent = message;
            document.body.appendChild(statusDiv);
            
            setTimeout(() => {
                document.body.removeChild(statusDiv);
            }, 5000);
        }
        
        // Toggle SMS settings visibility
        function toggleSMSSettings() {
            const smsEnabled = document.getElementById('smsNotifications').checked;
            const smsSettings = document.getElementById('smsSettings');
            smsSettings.style.display = smsEnabled ? 'block' : 'none';
        }
        
        // Filter slots based on time preferences
        function filterSlotsByTime(slots) {
            const morningEnabled = document.getElementById('morningFilter').checked;
            const eveningEnabled = document.getElementById('eveningFilter').checked;
            
            if (!morningEnabled && !eveningEnabled) {
                return [];
            }
            
            return slots.filter(slot => {
                const timeStr = slot.time.toLowerCase();
                let hour = parseInt(timeStr.split(':')[0]);
                const isPM = timeStr.includes('p');
                
                if (isPM && hour !== 12) {
                    hour += 12;
                } else if (!isPM && hour === 12) {
                    hour = 0;
                }
                
                const isMorning = hour < 13;
                const isEvening = hour >= 13;
                
                return (morningEnabled && isMorning) || (eveningEnabled && isEvening);
            });
        }
        
        // Parse court data for a specific park - enhanced debugging and fixing
        function parseCourtData(htmlContent, parkId) {
            console.log(`🔍 Parsing data for park ${parkId}`);
            
            const dates = getWeekendDates();
            console.log("🗓️ Target weekend dates:");
            console.log("- Saturday:", dates.saturday);
            console.log("- Sunday:", dates.sunday);
            
            const saturdayStr = dates.saturday.toLocaleDateString('en-US', { 
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
            });
            const sundayStr = dates.sunday.toLocaleDateString('en-US', { 
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
            });
            
            console.log("📅 Looking for date strings:");
            console.log(`- Saturday: "${saturdayStr}"`);
            console.log(`- Sunday: "${sundayStr}"`);
            
            const park = nycParks.find(p => p.id === parkId);
            const results = {
                parkName: park ? park.name : `Park ${parkId}`,
                saturday: { available: [], date: saturdayStr },
                sunday: { available: [], date: sundayStr }
            };
            
            // More robust HTML parsing using DOM instead of line-by-line
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, 'text/html');
            
            // Find all date headers in the document
            const allText = doc.body.textContent || doc.body.innerText || '';
            const dateMatches = allText.match(/\w+,\s+\w+\s+\d{1,2},\s+\d{4}/g);
            console.log("📅 All dates found in document:", dateMatches);
            
            // Look for weekend date matches specifically
            const saturdayInDoc = allText.includes(saturdayStr);
            const sundayInDoc = allText.includes(sundayStr);
            console.log(`🎯 Weekend dates in document: Saturday=${saturdayInDoc}, Sunday=${sundayInDoc}`);
            
            // Find all tables that might contain court data
            const tables = doc.querySelectorAll('table');
            console.log(`📊 Found ${tables.length} tables`);
            
            tables.forEach((table, tableIndex) => {
                console.log(`\n🔍 Analyzing table ${tableIndex + 1}`);
                
                // Look for date context around this table more thoroughly
                let dateContext = '';
                let element = table;
                let searchDepth = 0;
                
                // Search backwards through DOM for date information
                while (element && searchDepth < 20) {
                    if (element.previousElementSibling) {
                        element = element.previousElementSibling;
                        const text = element.textContent || element.innerText || '';
                        
                        // Check if this element contains a date
                        if (text.includes('Saturday') && text.includes('2025')) {
                            dateContext = text.trim();
                            console.log(`📅 Found Saturday context: "${dateContext}"`);
                            break;
                        } else if (text.includes('Sunday') && text.includes('2025')) {
                            dateContext = text.trim();
                            console.log(`📅 Found Sunday context: "${dateContext}"`);
                            break;
                        }
                    } else {
                        element = element.parentElement;
                    }
                    searchDepth++;
                }
                
                // Exact string matching for weekend identification
                const isCurrentSaturday = dateContext.includes(saturdayStr);
                const isCurrentSunday = dateContext.includes(sundayStr);
                const isTargetWeekend = isCurrentSaturday || isCurrentSunday;
                
                console.log(`🎯 Table ${tableIndex + 1} analysis:`);
                console.log(`   - Date context: "${dateContext}"`);
                console.log(`   - Is current Saturday: ${isCurrentSaturday}`);
                console.log(`   - Is current Sunday: ${isCurrentSunday}`);
                console.log(`   - Is target weekend: ${isTargetWeekend}`);
                
                if (isTargetWeekend) {
                    console.log(`✅ Processing table ${tableIndex + 1} for current weekend`);
                    
                    // Process table rows
                    const rows = table.querySelectorAll('tr');
                    console.log(`📋 Table has ${rows.length} rows`);
                    
                    rows.forEach((row, rowIndex) => {
                        const cells = row.querySelectorAll('td, th');
                        
                        // Look for time in first cell
                        if (cells.length > 0) {
                            const firstCellText = cells[0].textContent || '';
                            const timeMatch = firstCellText.match(/(\d{1,2}:\d{2}\s*[ap]\.?m\.?)/i);
                            
                            if (timeMatch) {
                                console.log(`⏰ Row ${rowIndex} time: "${timeMatch[1]}"`);
                                
                                // Check each cell for reservation links
                                cells.forEach((cell, cellIndex) => {
                                    const reserveLink = cell.querySelector('a[href*="/tennisreservation/reservecp/"]');
                                    if (reserveLink) {
                                        // Better court number detection
                                        let courtNumber = '';
                                        
                                        // Try header row first
                                        const headerRow = table.querySelector('tr');
                                        if (headerRow && headerRow.cells[cellIndex]) {
                                            const headerText = headerRow.cells[cellIndex].textContent;
                                            const headerCourtMatch = headerText.match(/Court\s*(\d+)/i);
                                            if (headerCourtMatch) {
                                                courtNumber = headerCourtMatch[1];
                                            }
                                        }
                                        
                                        // Fallback: look in cell content
                                        if (!courtNumber) {
                                            const cellCourtMatch = cell.textContent.match(/Court\s*(\d+)/i);
                                            if (cellCourtMatch) {
                                                courtNumber = cellCourtMatch[1];
                                            }
                                        }
                                        
                                        // Final fallback: use position
                                        if (!courtNumber) {
                                            courtNumber = String(cellIndex);
                                        }
                                        
                                        console.log(`🎾 Found reservation link:`, {
                                            time: timeMatch[1],
                                            court: courtNumber,
                                            link: reserveLink.getAttribute('href'),
                                            cellIndex: cellIndex,
                                            weekendDay: isCurrentSaturday ? 'Saturday' : 'Sunday'
                                        });
                                        
                                        const slot = {
                                            time: timeMatch[1],
                                            court: courtNumber,
                                            link: reserveLink.getAttribute('href'),
                                            park: results.parkName
                                        };
                                        
                                        // Add to correct day based on exact date matching
                                        if (isCurrentSaturday) {
                                            results.saturday.available.push(slot);
                                            console.log(`➕ Added to Saturday: ${slot.time} Court ${slot.court}`);
                                        } else if (isCurrentSunday) {
                                            results.sunday.available.push(slot);
                                            console.log(`➕ Added to Sunday: ${slot.time} Court ${slot.court}`);
                                        }
                                    }
                                });
                            }
                        }
                    });
                } else {
                    console.log(`⏭️ Skipping table ${tableIndex + 1} - not current weekend`);
                    console.log(`   Expected Saturday: "${saturdayStr}"`);
                    console.log(`   Expected Sunday: "${sundayStr}"`);
                    console.log(`   Found context: "${dateContext}"`);
                }
            });
            
            console.log("📊 Final parsing results:", results);
            return results;
        }
        
        // Check court availability for all selected parks
        async function checkAvailability() {
            const checkBtn = document.getElementById('checkBtn');
            const resultsDiv = document.getElementById('results');
            
            const selectedParkIds = getSelectedParkIds();
            if (selectedParkIds.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="status-card unavailable">
                        <h3>⚠️ No Parks Selected</h3>
                        <p>Please select at least one park to monitor from the list above.</p>
                    </div>
                `;
                return;
            }
            
            checkBtn.disabled = true;
            checkBtn.textContent = 'Checking...';
            resultsDiv.innerHTML = '<div class="loading">Checking court availability across selected parks...</div>';
            
            try {
                const BACKEND_PROXY_URL = 'https://tennis-court-monitor.vercel.app/api/proxy';
                
                const allResults = [];
                
                // Check each selected park
                for (const parkId of selectedParkIds) {
                    try {
                        const response = await fetch(`${BACKEND_PROXY_URL}?parkId=${parkId}`, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json'
                            }
                        });
                        
                        if (response.ok) {
                            const jsonData = await response.json();
                            const htmlContent = jsonData.contents || '';
                            
                            if (htmlContent && htmlContent.length > 1000) {
                                const courtData = parseCourtData(htmlContent, parkId);
                                
                                // Apply time filters
                                courtData.saturday.available = filterSlotsByTime(courtData.saturday.available);
                                courtData.sunday.available = filterSlotsByTime(courtData.sunday.available);
                                
                                allResults.push(courtData);
                            }
                        }
                    } catch (parkError) {
                        console.error(`Error checking park ${parkId}:`, parkError);
                    }
                }
                
                displayAllResults(allResults);
                updateLastChecked();
                
                // Check for notifications
                const totalAvailable = allResults.reduce((total, park) => 
                    total + park.saturday.available.length + park.sunday.available.length, 0);
                
                if (totalAvailable > 0) {
                    const parkNames = allResults
                        .filter(park => park.saturday.available.length > 0 || park.sunday.available.length > 0)
                        .map(park => park.parkName);
                    
                    let notificationMessage = `🎾 Tennis courts available! ${totalAvailable} slot(s) found:\n`;
                    notificationMessage += `Parks: ${parkNames.join(', ')}\n`;
                    notificationMessage += `Book now: https://www.nycgovparks.org/tennisreservation`;
                    
                    if (document.getElementById('soundNotifications').checked) {
                        playNotificationSound();
                    }
                    
                    if (document.getElementById('browserNotifications').checked && Notification.permission === 'granted') {
                        new Notification('NYC Tennis Courts Available!', {
                            body: `${totalAvailable} court slot(s) now available across ${parkNames.length} park(s).`,
                            icon: '🎾'
                        });
                    }
                    
                    await sendSMS(notificationMessage);
                }
                
            } catch (error) {
                console.error('Error checking availability:', error);
                
                resultsDiv.innerHTML = `
                    <div class="status-card unavailable">
                        <h3>❌ Error Checking Availability</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p><strong>Manual check:</strong> <a href="https://www.nycgovparks.org/tennisreservation" target="_blank">NYC Parks Tennis Reservations</a></p>
                    </div>
                `;
            }
            
            checkBtn.disabled = false;
            checkBtn.textContent = 'Check Now';
        }
        
        // Display results for all parks
        function displayAllResults(allResults) {
            const resultsDiv = document.getElementById('results');
            
            const totalAvailable = allResults.reduce((total, park) => 
                total + park.saturday.available.length + park.sunday.available.length, 0);
            
            const morningEnabled = document.getElementById('morningFilter').checked;
            const eveningEnabled = document.getElementById('eveningFilter').checked;
            
            let timeFilterText = '';
            if (morningEnabled && eveningEnabled) {
                timeFilterText = ' (all times)';
            } else if (morningEnabled) {
                timeFilterText = ' (morning slots only)';
            } else if (eveningEnabled) {
                timeFilterText = ' (afternoon/evening slots only)';
            } else {
                timeFilterText = ' (no time filters selected)';
            }
            
            let html = '';
            
            if (totalAvailable === 0) {
                html = `
                    <div class="status-card unavailable">
                        <h3>❌ No Courts Available</h3>
                        <p>No courts are currently available for reservation this weekend${timeFilterText} at your selected parks.</p>
                    </div>
                `;
                
                // Show status for each park
                allResults.forEach(park => {
                    html += `
                        <div class="status-card">
                            <h4>${park.parkName}</h4>
                            <p><strong>Saturday:</strong> ${park.saturday.date} - No matching slots</p>
                            <p><strong>Sunday:</strong> ${park.sunday.date} - No matching slots</p>
                        </div>
                    `;
                });
            } else {
                html = `
                    <div class="status-card available">
                        <h3>✅ Courts Available!</h3>
                        <p><strong>${totalAvailable}</strong> court slot(s) available this weekend${timeFilterText}!</p>
                    </div>
                `;
                
                // Show results for each park with available courts
                allResults.forEach(park => {
                    const parkTotal = park.saturday.available.length + park.sunday.available.length;
                    if (parkTotal > 0) {
                        html += `<div class="status-card">
                            <h4>${park.parkName} (${parkTotal} slots)</h4>`;
                        
                        // Saturday results
                        if (park.saturday.available.length > 0) {
                            html += `
                                <h5>Saturday - ${park.saturday.date} (${park.saturday.available.length} slots)</h5>
                                <table class="court-table">
                                    <tr><th>Time</th><th>Court</th><th>Action</th></tr>
                            `;
                            park.saturday.available.forEach(slot => {
                                html += `
                                    <tr class="available-slot">
                                        <td>${slot.time}</td>
                                        <td>Court ${slot.court}</td>
                                        <td><a href="https://www.nycgovparks.org${slot.link}" target="_blank">Reserve Now</a></td>
                                    </tr>
                                `;
                            });
                            html += '</table>';
                        }
                        
                        // Sunday results
                        if (park.sunday.available.length > 0) {
                            html += `
                                <h5>Sunday - ${park.sunday.date} (${park.sunday.available.length} slots)</h5>
                                <table class="court-table">
                                    <tr><th>Time</th><th>Court</th><th>Action</th></tr>
                            `;
                            park.sunday.available.forEach(slot => {
                                html += `
                                    <tr class="available-slot">
                                        <td>${slot.time}</td>
                                        <td>Court ${slot.court}</td>
                                        <td><a href="https://www.nycgovparks.org${slot.link}" target="_blank">Reserve Now</a></td>
                                    </tr>
                                `;
                            });
                            html += '</table>';
                        }
                        
                        html += '</div>';
                    }
                });
            }
            
            resultsDiv.innerHTML = html;
        }
        
        // Toggle auto refresh
        function toggleAutoRefresh() {
            const autoBtn = document.getElementById('autoBtn');
            const intervalSelect = document.getElementById('refreshInterval');
            
            if (isAutoRefreshing) {
                clearInterval(autoRefreshInterval);
                autoBtn.textContent = 'Start Auto-Check';
                intervalSelect.disabled = false;
                isAutoRefreshing = false;
            } else {
                const interval = parseInt(intervalSelect.value) * 1000;
                autoRefreshInterval = setInterval(checkAvailability, interval);
                autoBtn.textContent = 'Stop Auto-Check';
                intervalSelect.disabled = true;
                isAutoRefreshing = true;
                
                checkAvailability();
            }
        }
        
        // Update last checked time
        function updateLastChecked() {
            const now = new Date();
            document.getElementById('lastChecked').textContent = 
                `Last checked: ${now.toLocaleTimeString()}`;
        }
        
        // Request notification permission
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }
        
        // Initialize
        window.onload = function() {
            initializeParkSelector();
            updateWeekendDisplay();
            requestNotificationPermission();
            
            // Add event listeners
            document.getElementById('smsNotifications').addEventListener('change', toggleSMSSettings);
            
            // Load saved settings from localStorage if available
            try {
                const savedPhone = localStorage.getItem('tennisMonitor_phone');
                const savedSid = localStorage.getItem('tennisMonitor_twilioSid');
                const savedFrom = localStorage.getItem('tennisMonitor_twilioFrom');
                
                if (savedPhone) document.getElementById('phoneNumber').value = savedPhone;
                if (savedSid) document.getElementById('twilioSid').value = savedSid;
                if (savedFrom) document.getElementById('twilioFrom').value = savedFrom;
            } catch (e) {
                // localStorage not available or error reading
            }
        };
        
        // Save settings when they change
        function saveSettings() {
            try {
                localStorage.setItem('tennisMonitor_phone', document.getElementById('phoneNumber').value);
                localStorage.setItem('tennisMonitor_twilioSid', document.getElementById('twilioSid').value);
                localStorage.setItem('tennisMonitor_twilioFrom', document.getElementById('twilioFrom').value);
            } catch (e) {
                // localStorage not available
            }
        }
        
        // Add save functionality to inputs
        document.addEventListener('DOMContentLoaded', function() {
            ['phoneNumber', 'twilioSid', 'twilioFrom'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', saveSettings);
                }
            });
        });
    </script>
</body>
</html>
